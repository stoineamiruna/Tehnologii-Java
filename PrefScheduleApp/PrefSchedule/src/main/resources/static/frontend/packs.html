<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Packs - PrefSchedule</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
    /* === Global Styles === */
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height:100vh; padding:20px;
    }
    .navbar {
            background: white;
            padding: 15px 30px;
            border-radius: 12px;
            margin: 0 auto 20px auto; 
            max-width: 1400px;        
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .navbar h2 { color:#667eea; display:flex; align-items:center; gap:10px; }
    .btn {
        padding:10px 20px; border:none; border-radius:8px; font-weight:600;
        cursor:pointer; transition:all 0.3s; text-decoration:none; display:inline-flex;
        align-items:center; gap:8px;
    }
    .btn-secondary { background:#f0f0f0; color:#333; }
    .btn-secondary:hover { background:#e0e0e0; }
    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color:white;
    }
    .btn-primary:hover { transform: translateY(-2px); box-shadow:0 5px 15px rgba(102,126,234,0.4); }
    .container {
        background:white; border-radius:12px; padding:30px;
        box-shadow:0 10px 30px rgba(0,0,0,0.2); max-width:1400px; margin:0 auto;
    }
    .controls { display:flex; justify-content:space-between; align-items:center; margin-bottom:25px; flex-wrap:wrap; gap:15px; }
    .search-box { flex:1; min-width:250px; position:relative; }
    .search-box input {
        width:100%; padding:12px 40px 12px 15px; border:2px solid #e0e0e0; border-radius:8px; font-size:1em;
    }
    .search-box i { position:absolute; right:15px; top:50%; transform:translateY(-50%); color:#999; }
    .packs-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap:20px; }
    .pack-card {
        background:#f8f9fa; border:2px solid #e0e0e0; border-radius:12px; padding:25px;
        transition:all 0.3s; cursor:pointer;
    }
    .pack-card:hover { transform:translateY(-5px); box-shadow:0 8px 20px rgba(102,126,234,0.3); border-color:#667eea; }
    .pack-header { display:flex; justify-content:space-between; align-items:start; margin-bottom:15px; }
    .pack-title { font-size:1.3em; font-weight:600; color:#333; margin-bottom:5px; }
    .pack-info { margin:15px 0; }
    .info-row { display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid #e0e0e0; }
    .info-row:last-child { border-bottom:none; }
    .info-label { color:#666; font-size:0.9em; }
    .info-value { font-weight:600; color:#333; }
    .pack-actions { display:flex; gap:10px; margin-top:15px; padding-top:15px; border-top:2px solid #e0e0e0; }
    .btn-icon { padding:8px 12px; border:none; border-radius:6px; cursor:pointer; transition:all 0.3s; flex:1; font-size:0.9em; font-weight:600; }
    .btn-edit { background:#3498db; color:white; } .btn-edit:hover { background:#2980b9; }
    .btn-delete { background:#e74c3c; color:white; } .btn-delete:hover { background:#c0392b; }
    .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center; }
    .modal.active { display:flex; }
    .modal-content { background:white; border-radius:12px; padding:30px; max-width:500px; width:90%; max-height:90vh; overflow-y:auto; }
    .modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
    .modal-header h3 { color:#667eea; }
    .close-btn { background:none; border:none; font-size:1.5em; cursor:pointer; color:#999; }
    .form-group { margin-bottom:20px; }
    .form-group label { display:block; margin-bottom:8px; color:#333; font-weight:500; }
    .form-group input { width:100%; padding:12px; border:2px solid #e0e0e0; border-radius:8px; font-size:1em; font-family:inherit; }
    .form-group input:focus { outline:none; border-color:#667eea; }
    .loading { text-align:center; padding:40px; color:#667eea; }
    .loading i { font-size:2em; animation:spin 1s linear infinite; }
    @keyframes spin { from{transform:rotate(0deg);} to{transform:rotate(360deg);} }
    .empty-state { text-align:center; padding:60px 20px; color:#999; }
    .empty-state i { font-size:4em; margin-bottom:20px; color:#ddd; }
    .alert { padding:12px 20px; border-radius:8px; margin-bottom:20px; }
    .alert-success { background:#d4edda; color:#155724; border:1px solid #c3e6cb; }
    .alert-error { background:#f8d7da; color:#721c24; border:1px solid #f5c6cb; }
</style>
</head>
<body>
<div class="navbar">
    <h2><i class="fas fa-box"></i> Pack Management</h2>
    <div>
        <a href="index.html" class="btn btn-secondary"><i class="fas fa-home"></i> Dashboard</a>
    </div>
</div>

<div class="container">
    <div id="alertContainer"></div>

    <div class="controls">
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Search packs...">
            <i class="fas fa-search"></i>
        </div>
        <button class="btn btn-primary" onclick="openCreateModal()" id="createBtn"><i class="fas fa-plus"></i> Add Pack</button>
    </div>

    <div id="loadingIndicator" class="loading">
        <i class="fas fa-spinner"></i>
        <p>Loading packs...</p>
    </div>

    <div id="packsGrid" class="packs-grid" style="display:none;"></div>

    <div id="emptyState" class="empty-state" style="display:none;">
        <i class="fas fa-box"></i>
        <h3>No Packs Found</h3>
        <p>Start by adding your first pack</p>
    </div>
</div>

<!-- Modal for Create/Edit Pack -->
<div id="packModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitle">Add Pack</h3>
            <button class="close-btn" onclick="closeModal()">&times;</button>
        </div>
        <form id="packForm">
            <div class="form-group">
                <label>Pack Name *</label>
                <input type="text" id="packName" required>
            </div>
            <div class="form-group">
                <label>Year *</label>
                <input type="number" id="packYear" min="2000" max="2100" required>
            </div>
            <div class="form-group">
                <label>Semester *</label>
                <select id="packSemester" required>
                    <option value="1">Semester 1</option>
                    <option value="2">Semester 2</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary" style="width:100%;"><i class="fas fa-save"></i> Save Pack</button>
        </form>
    </div>
</div>

<script>
const API_BASE = 'http://localhost:8080';
let authToken = localStorage.getItem('authToken');
let packs = [];
let editingPackId = null;

if (!authToken) window.location.href = 'index.html';

window.addEventListener('load', loadPacks);
document.getElementById('searchInput').addEventListener('input', (e) => {
    const searchTerm = e.target.value.toLowerCase();
    renderPacks(packs.filter(p => p.name.toLowerCase().includes(searchTerm)));
});

async function loadPacks() {
    try {
        const res = await fetch(`${API_BASE}/api/packs`, { headers: { 'Authorization': `Bearer ${authToken}` } });
        if(res.ok) {
            packs = await res.json();
            renderPacks(packs);
        } else showAlert('Failed to load packs', 'error');
    } catch(e) { showAlert('Connection error!', 'error'); }
    finally { document.getElementById('loadingIndicator').style.display='none'; }
}

function renderPacks(data) {
    const grid = document.getElementById('packsGrid');
    const emptyState = document.getElementById('emptyState');
    if(data.length===0){ grid.style.display='none'; emptyState.style.display='block'; return; }
    grid.style.display='grid'; emptyState.style.display='none';
    grid.innerHTML = data.map(p => `
        <div class="pack-card">
            <div class="pack-header">
                <div class="pack-title">${p.name}</div>
                <div class="info-value">Year ${p.year} - Sem ${p.semester}</div>
            </div>
            <div class="pack-info">
                <div class="info-row"><span class="info-label">Courses Count</span><span class="info-value">${p.coursesCount || 0}</span></div>
            </div>
            <div class="pack-actions">
                <button class="btn-icon btn-edit" onclick="editPack(${p.id})"><i class="fas fa-edit"></i> Edit</button>
                <button class="btn-icon btn-delete" onclick="deletePack(${p.id})"><i class="fas fa-trash"></i> Delete</button>
            </div>
        </div>
    `).join('');
}

function openCreateModal() {
    editingPackId=null; document.getElementById('modalTitle').textContent='Add Pack';
    document.getElementById('packForm').reset();
    document.getElementById('packModal').classList.add('active');
}

function editPack(id) {
    const p=packs.find(pack=>pack.id===id);
    if(!p) return;
    editingPackId=id; document.getElementById('modalTitle').textContent='Edit Pack';
    document.getElementById('packName').value=p.name;
    document.getElementById('packYear').value=p.year;
    document.getElementById('packSemester').value=p.semester;
    document.getElementById('packModal').classList.add('active');
}

function closeModal() { document.getElementById('packModal').classList.remove('active'); document.getElementById('packForm').reset(); editingPackId=null; }

document.getElementById('packForm').addEventListener('submit', async e=>{
    e.preventDefault();
    const data={
        name: document.getElementById('packName').value,
        year: parseInt(document.getElementById('packYear').value),
        semester: parseInt(document.getElementById('packSemester').value)
    };
    try {
        let res;
        if(editingPackId){
            res=await fetch(`${API_BASE}/api/packs/${editingPackId}`,{
                method:'PUT',
                headers:{'Authorization':`Bearer ${authToken}`,'Content-Type':'application/json'},
                body:JSON.stringify(data)
            });
        } else {
            res=await fetch(`${API_BASE}/api/packs`,{
                method:'POST',
                headers:{'Authorization':`Bearer ${authToken}`,'Content-Type':'application/json'},
                body:JSON.stringify(data)
            });
        }
        if(res.ok){ showAlert(editingPackId?'Pack updated!':'Pack created!','success'); closeModal(); loadPacks(); }
        else showAlert('Operation failed','error');
    } catch(e){ showAlert('Connection error!','error'); }
});

async function deletePack(id){
    if(!confirm('Are you sure you want to delete this pack?')) return;
    try{
        const res=await fetch(`${API_BASE}/api/packs/${id}`,{method:'DELETE',headers:{'Authorization':`Bearer ${authToken}`}});
        if(res.ok){ showAlert('Pack deleted!','success'); loadPacks(); } else showAlert('Failed to delete pack','error');
    } catch(e){ showAlert('Connection error!','error'); }
}

function showAlert(msg,type){
    const container=document.getElementById('alertContainer');
    const alert=document.createElement('div'); alert.className=`alert alert-${type}`; alert.textContent=msg;
    container.appendChild(alert); setTimeout(()=>alert.remove(),3000);
}

document.getElementById('packModal').addEventListener('click', e=>{ if(e.target.id==='packModal') closeModal(); });
</script>
</body>
</html>
